---
layout: post
---

# はじめての関数の関数

![fun_strategy](/assets/js_004/4_1.png)

数字や文字といった他のデータと違って、関数は二種類の呼び出し方ができます。

### 値呼び出し

値呼出し：関数への入力を値になるまで評価する呼び出し方です。

``` javascript
const loop = _ => loop(); // 無限ループする関数
loop();                   // 無限ループでエラー

const one = _ => 1;       // 引数を使わない関数でも
one(loop());              // エラーになる
```

``関数名(引数)`` とすると、関数の右辺が評価されるのでした。
世の中には、遅延評価(Lazy)といって実際に使われるまで評価されない言語もありますが、
JavaScript は正格評価(Eager)といって律儀に呼ばれます。

(註) JS では [yield](https://developer.mozilla.org/ja/docs/Web/JavaScript/New_in_JavaScript/1.7)
などで実際に使うまで評価を遅らせることもできます。


### 名前呼び出し

では、関数を渡す方法について説明します。
今度は関数oneは「関数の出力値」でなく「関数の名前」が入力されます。
これを名前呼び出しといいます。

``` javascript
loop;           // なにもおきない
one(loop);      // => 1
one(_=>loop()); // => 1
```


---

### 入力が関数の関数の例 : 実行時間の計測

こんな関数 time が作れたら便利ですよね。

``` javascript
// 使い方 1回だけ計る
time(_=> square(2000));
// 1000回分の平均時間
time(_=> square(2000), 1000);
```

中身はこんな感じになってます。

``` javascript
const time = (input, n = 1, average = 0.0) =>
{
    for (let i = 0; i < n; ++i) // n回ループ
    {
        const start = window.performance.now(); // 現在時刻の取得
        input(); // ここで入力の関数を動かす
        const elapsed = window.performance.now() - start; // 掛かった時間
        average += elapsed / n;
    }

    return average + " [ms]"; // 戻り値
};
```

チェックポイント

+ 2行目 ``(input, n = 1, average = 0.0)`` に ``=`` がであります。
これはデフォルト引数といって、入力が指定されなかったときの値になります。

+ 3行目 ... 最後の行の ``{ ... return }`` は、複数の命令と、返す(return)値を書く方法です。

+ 4行目 ``for (let i = 0; i < n; ++i)`` は再帰を使わずに n 回ループする方法です。
いままで通り再帰を使うとこんな感じでかけます。

``` javascript
// 再帰ver : for ループと比べてみよう
const time_rec = (process, n = 1, average = 0.0, i = 1) =>
{
    const start = window.performance.now();
    process();
    const elapsed = window.performance.now() - start;
    average += elapsed / n;

    return i < n
        ? time_rec(process, n, average, i + 1)
        : average + " [ms]";
};
```


[次はいよいよ関数を入力にとって出力する関数の登場です。](js_004-2.html)
